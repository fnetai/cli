name: cli

commands:
  build:
    - bun run build
    - bun ./dist/fnode/index.js --version
    - bun ./dist/fnet/index.js --version
    - bun ./dist/frun/index.js --version
    - bun link

  deploy:
    - fnet build
    - bun publish --access public

  compile:
    steps:
      - frun build
      - pause: true

      - bun build ./dist/frun/index.js --compile --outfile=.bin/frun
      - du -h .bin/frun
      - chmod +x .bin/frun
      - .bin/frun --help
      - otool -L .bin/frun
      - cp .bin/frun /usr/local/bin/xfrun && chmod +x /usr/local/bin/xfrun && du -h /usr/local/bin/xfrun
      - pause: true

      - bun build ./dist/fnode/index.js --compile --outfile=.bin/fnode
      - du -h .bin/fnode
      - chmod +x .bin/fnode
      - .bin/fnode --help
      - otool -L .bin/fnode
      - cp .bin/fnode /usr/local/bin/xfnode && chmod +x /usr/local/bin/xfnode && du -h /usr/local/bin/xfnode
      - pause: true

      - bun build ./dist/fnet/index.js --compile --outfile=.bin/fnet
      - du -h .bin/fnet
      - chmod +x .bin/fnet
      - .bin/fnet --help
      - otool -L .bin/fnet
      - cp .bin/fnet /usr/local/bin/xfnet && chmod +x /usr/local/bin/xfnet && du -h /usr/local/bin/xfnet
      - pause: true

  create-fnode-node:
    - rm -rf .tests/fnode-node
    - wdir: .tests
      steps:
        - fnode create --name fnode-node --runtime node
        - wdir: .tests/fnode-node
          steps:
            # - fnode build
            - fnode cli

  create-fnet-node:
    - rm -rf .tests/fnet-node
    - wdir: .tests
      steps:
        - fnet create --name fnet-node --runtime node
        - wdir: .tests/fnet-node
          steps:
            # - fnet build
            - fnet cli

  create-fnode-python:
    - rm -rf .tests/fnode-python
    - wdir: .tests
      steps:
        - fnode create --name fnode-python --runtime python
        - wdir: .tests/fnode-python
          steps:
            # - fnode build
            - fnode cli

  create-fnode-bun:
    - rm -rf .tests/fnode-bun
    - wdir: .tests
      steps:
        - fnode create --name fnode-bun --runtime bun
        - wdir: .tests/fnode-bun
          steps:
            # - fnode build
            - fnode cli

  create-all:
    - xfrun create-fnode-node
    - xfrun create-fnet-node
    - xfrun create-fnode-python
    - xfrun create-fnode-bun

  test-examples:
    - wdir: examples/fnode/node-1
      steps:
        - fnode build
        - fnode cli
    - wdir: examples/fnode/python-1
      steps:
        - fnode build
        - fnode cli
    - wdir: examples/fnode/bun-1
      steps:
        - fnode build
        - fnode cli
    - wdir: examples/fnet/node-1
      steps:
        - fnet build
        - fnet cli