name: cli

commands:
  build:
    - bun run build
    - node ./dist/fnode/index.js --version
    - node ./dist/fnet/index.js --version
    - bun link

  deploy:
    - fnet build
    - bun publish --access public
    
  compile:
    steps:
      - fnet run build
      - bun build ./src/builder/lib-cli.js --compile --outfile=.bin/fnode
      - bun build ./src/builder/wf-cli.js --compile --outfile=.bin/fnode
      # - bun build ./dist/fnode/index.js --compile --outfile=.bin/fnode
      # - bun build ./dist/fnet/index.js --compile --outfile=.bin/fnet
      - chmod +x .bin/fnode && chmod +x .bin/fnet
      - chmod +x .bin/fnode && chmod +x .bin/fnet
      - du -h .bin/fnode && du -h .bin/fnet
      - .bin/fnode --version && .bin/fnet --version
      - .bin/fnode --help && .bin/fnet --help
      - otool -L .bin/fnode && otool -L .bin/fnet
      - file .bin/fnode && file .bin/fnet
      - cp .bin/fnode /usr/local/bin/xfnode && cp .bin/fnet /usr/local/bin/xfnet
      - chmod +x /usr/local/bin/xfnode && chmod +x /usr/local/bin/xfnet
      - du -h /usr/local/bin/xfnode && du -h /usr/local/bin/xfnet

    # env:
    #   DEVELOPMENT: true