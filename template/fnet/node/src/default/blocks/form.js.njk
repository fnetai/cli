{% import "src/default/types/block.js.njk" as block with context %}

{% call block.header() %}

  {% include "src/default/macros/block-library-header.js.njk" %}

  import React from "react";

{% endcall %}

{% call block.definition() %}

  flow.waitForNext({
    key:'{{indexKey}}',
    next: async () => {
      {% if context.transform.return %}
        resolve({type:'return',value: {{context.transform.return | safe}}});
      {% elseif context.next %}
        {% include "src/default/macros/block-next.js.njk" %}
      {% else %}
        resolve();
      {% endif %}
    }
  });
  
  {% if context.lib.type==='atom'%}
    const formLib=LIBRARY;
  {% elseif context.lib.type==='subworkflow' %}
    const formLib={{context.lib.codeKey}};
  {% else %}
    const formLib=undefined; 
    throw new Error('Couldnt find form.');
  {% endif %}

  {% include "src/default/macros/block-run-form.js.njk" %}

  {% include "src/default/macros/block-assign.js.njk" %}
  
  {% include "src/default/macros/block-signal.js.njk" %}

{% endcall %}

{% call block.footer()%} 
{% endcall %}